name: simplex-chat
buildsystem: simple
build-commands:
  - ar x simplex-chat-setup.deb
  - tar xf data.tar.zst -C ${FLATPAK_DEST} --strip-components=2 ./opt
  - rm -f *.tar.* debian-binary *.deb
  - mkdir --parents ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps
  - mv ${FLATPAK_DEST}/simplex/lib/simplex.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
  - find . -type f -name '*.desktop' -delete
  - install -Dm644 /dev/null ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
  - desktop-file-edit --set-key="Exec" --set-value="${FLATPAK_DEST}/simplex/bin/simplex %U" --set-name="Simplex Chat" --set-icon="${FLATPAK_ID}" --set-key="Type" --set-value="Application" --add-category="GTK;" ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
  - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo ${FLATPAK_ID}.metainfo.xml
sources:
  - type: file
    dest-filename: simplex-chat-setup.deb
    url: https://github.com/simplex-chat/simplex-chat/releases/download/v5.3.1/simplex-desktop-ubuntu-22_04-x86_64.deb
    sha512: 5acacb6fb6d7e6e9feae14bc7a14e84d0ff4ad71992f5c9f1145c57fa68842d597da35a7c517539e6c818fda151e0edab5b96599fbabdd53921a651a7e34108d
  - type: file
    path: com.github.simplex-chat.metainfo.xml
